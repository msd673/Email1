<!DOCTYPE html>

<html class="app-ui">

<head>
    <!-- Meta -->
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />

    <!-- Document title -->
    <title>回收站</title>

    <meta name="description" content="AppUI - Admin Dashboard Template & UI Framework" />
    <meta name="author" content="rustheme" />
    <meta name="robots" content="noindex, nofollow" />

    <!-- Favicons -->
    <link rel="apple-touch-icon" href="../../static/img/favicons/apple-touch-icon.png" />
    <link rel="icon" href="../../static/img/favicons/favicon.ico" />

    <!-- Google fonts -->
    <link rel="stylesheet"
        href="http://fonts.googleapis.com/css?family=Roboto:300,400,400italic,500,900%7CRoboto+Slab:300,400%7CRoboto+Mono:400" />

    <!-- AppUI CSS stylesheets -->
    <link rel="stylesheet" id="css-font-awesome" href="../../static/css/font-awesome.css" />
    <link rel="stylesheet" id="css-ionicons" href="../../static/css/ionicons.css" />
    <link rel="stylesheet" id="css-bootstrap" href="../../static/css/bootstrap.css" />
    <link rel="stylesheet" id="css-app" href="../../static/css/app.css" />
    <link rel="stylesheet" id="css-app-custom" href="../../static/css/app-custom.css" />
    <!-- End Stylesheets -->
</head>

<body class="app-ui layout-has-drawer layout-has-fixed-header">
    <div class="app-layout-canvas">
        <div class="app-layout-container">

            <!-- Drawer -->
            <aside class="app-layout-drawer">

                <!-- Drawer scroll area -->
                <div class="app-layout-drawer-scroll">
                    <!-- Drawer logo -->
                    <div id="logo" class="drawer-header">
                        <a href="#"><img class="img-responsive" src="../../static/img/logo/logo-backend.jpg"
                                title="AppUI" alt="AppUI" /></a>
                    </div>

                    <!-- Drawer navigation -->
                    <nav class="drawer-main">
                        <ul class="nav nav-drawer">

                            <li class="nav-item nav-drawer-header">菜单</li>

                            <li class="nav-item nav-item-has-subnav">
                                <a href="/WriteEmail"><i class="ion-ios-compose-outline"></i> 写邮件</a>
                            </li>

                            <li class="nav-item nav-item-has-subnav">
                                <a href="/ReceiveEmail"><i class="ion-ios-calculator-outline"></i> 收件箱</a>
                            </li>
                            

                            <li class="nav-item nav-item-has-subnav">
                                <a href="/SentEmail"><i class="ion-ios-list-outline"></i> 已发送</a>
                            </li>
                            
                            <li class="nav-item nav-item-has-subnav" style="background-color:rgb(125, 200, 85);">
                                <a href="/DeledEmail"><i class="fa fa-trash-o"></i> 回收站</a>
                            </li>

                        </ul>
                    </nav>
                </div>
                <!-- End drawer scroll area -->
            </aside>
            <!-- End drawer -->

            <!-- Header -->
            <header class="app-layout-header">
                <nav class="navbar navbar-default">
                    <!-- .navbar-left -->
                    <div class="container-fluid">
                        <div class="navbar-header">
                            <span class="navbar-page-title" id="userEmail">
                            </span>
                        </div>
                        <ul class="nav navbar-nav navbar-right navbar-toolbar hidden-sm hidden-xs">
                            <li>
                                <a href="/AdminIndex" id="showAdminIndex"></a>
                            </li>
                            <li>
                                <a href="/Index">首页 </a>
                            </li>

                            <li class="dropdown">
                                <a href="javascript:void(0)" data-toggle="dropdown">账户 <span class="caret"></span></a>
                                <ul class="dropdown-menu dropdown-menu-right">
                                    <li>
                                        <a tabindex="-1" href="/ChangePass"> 修改密码 </a>
                                    </li>
                                    <li>
                                        <a tabindex="-1" href="javascript:void(0)" id="logout"> 退出登录 </a>
                                    </li>
                                </ul>
                            </li>

                            <li class="dropdown">
                                <a href="javascript:void(0)" data-toggle="dropdown">
                                    <span class="m-r-sm dropdown"> </span>
                                </a>
                            </li>
                        </ul>
                    </div>

                    <!-- .navbar-right -->
        </div>
    </div>
    <!-- .container-fluid -->
    </nav>
    <!-- .navbar-default -->
    </header>
    <!-- End header -->

    <main class="app-layout-content">

        <!-- Page Content -->
        <div class="container-fluid p-y-md">

            <div class="row">
                <div class="col-lg-12">
                    <!-- Condensed Table -->
                    <div class="card">
                        <div class="card-header">
                            <h4>回收站</h4>
                        </div>
                        <div class="card-block">
                            <table class="table table-condensed">
                                <thead>
                                    <tr>
                                        <th class="text-center hidden-xs w-5">#</th>
                                        <th class="text-center hidden-xs w-20">发件人</th>
                                        <th class="text-center hidden-xs w-20">收件人</th>
                                        <th class="text-center hidden-xs w-20">主题</th>
                                        <th class="text-center hidden-xs w-15">时间</th>
                                        <th class="text-center" style="width: 100px;">动作</th>
                                    </tr>
                                </thead>
                                <tbody id="RecycleEmail">
                                    <!-- <tr>
                                        <td class="text-center" id="showId">1</td>
                                        <td class="text-center"><i class="ion-android-drafts"></i></td>
                                        <td class="text-center" id="showEmailFrom">12</td>
                                        <td class="text-center hidden-xs" id="showEmailSubject">12</td>
                                        <td class="text-center hidden-xs" id="showSendTime"></td>
                                        <td class="text-center">
                                            <div class="btn-group">
                                                <button class="btn btn-xs btn-default" type="button"
                                                    data-toggle="tooltip" title="Remove client" onclick="getForm()"><i
                                                        class="fa fa-search-plus"></i></button>
                                            </div>
                                            <div class="btn-group">
                                                <button class="btn btn-xs btn-default" type="button"
                                                    data-toggle="tooltip" title="Remove client" onclick="getForm()"><i
                                                        class="ion-close"></i></button>
                                            </div>
                                        </td>
                                    </tr> -->
                                </tbody>
                            </table>
                        </div>
                        <!-- .card-block -->
                    </div>
                    <!-- .card -->
                    <!-- End Condensed Table -->
                </div>
                <!-- .col-lg-6 -->
            </div>

        </div>
        <!-- .container-fluid -->
        <!-- End Page Content -->

        <!-- Slide Up Modal -->
        <div class="modal fade" id="modal-reply" tabindex="-1" role="dialog" aria-hidden="true">
            <div class="modal-dialog modal-dialog-reply">
                <div class="modal-content">
                    <div class="card-header bg-green bg-inverse">
                        <h4>提示</h4>
                        <ul class="card-actions">
                            <li>
                                <button data-dismiss="modal" type="button"><i class="ion-close"></i></button>
                            </li>
                        </ul>
                    </div>
                    <div class="card-block">
                        <p>确定要恢复邮件？</p>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-sm btn-default" type="button" data-dismiss="modal">取消</button>
                        <button class="btn btn-sm btn-app" type="button" data-dismiss="modal" id="replyEmail">确定</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- Slide Up Modal -->
        <div class="modal fade" id="modal-slideup" tabindex="-1" role="dialog" aria-hidden="true">
            <div class="modal-dialog modal-dialog-slideup">
                <div class="modal-content">
                    <div class="card-header bg-green bg-inverse">
                        <h4>提示</h4>
                        <ul class="card-actions">
                            <li>
                                <button data-dismiss="modal" type="button"><i class="ion-close"></i></button>
                            </li>
                        </ul>
                    </div>
                    <div class="card-block">
                        <p>确定要删除邮件？</p>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-sm btn-default" type="button" data-dismiss="modal">取消</button>
                        <button class="btn btn-sm btn-app" type="button" data-dismiss="modal" id="delEmail">确定</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- End Slide Up Modal -->

    </main>

    </div>
    <!-- .app-layout-container -->
    </div>
    <!-- .app-layout-canvas -->

    <div class="app-ui-mask-modal"></div>

    <!-- AppUI Core JS: jQuery, Bootstrap, slimScroll, scrollLock and App.js -->
    <script src="../../static/js/core/jquery.min.js"></script>
    <script src="../../static/js/core/bootstrap.min.js"></script>
    <script src="../../static/js/core/jquery.slimscroll.min.js"></script>
    <script src="../../static/js/core/jquery.scrollLock.min.js"></script>
    <script src="../../static/js/core/jquery.placeholder.min.js"></script>
    <script src="../../static/js/app.js"></script>
    <script src="../../static/js/app-custom.js"></script>

    <script type="text/javascript">
        var emailId;
        $(document).ready(function () {
            $.ajax({
                type: 'GET',
                url: '/GetIdentity',
                // async: false,
                dateType: "json",
                success: function (data) {
                    var email = "<" + data.userName + "@skyfall.icu" + ">";
                    $('#userEmail').text(email);
                    if (data.authorityNo == 1) $('#showAdminIndex').text("进入后台");
                }
            })
            $.ajax({
                type: 'GET',
                url: '/DeletedMailList',
                // async: false,
                dateType: "json",
                success: function (data) {
                    showTable(data.infoList);
                }
            })
        });
        function showTable(infoList) {
            for (var i = 0; i < infoList.length; i++) {
                // document.getElementById("showId").innerHTML = i + 1;
                // document.getElementById("showEmailFrom").innerHTML = infoList[i].emailFrom;
                // document.getElementById("showEmailSubject").innerHTML = infoList[i].emailSubject;
                // document.getElementById("showSendTime").innerHTML = infoList[i].sendTime;
                // time = datetime.strptime(infoList[i].sendTime, '%Y-%m-%d %H:%M:%S')
                var state;
                var sendTime = timeFormatter(infoList[i].sendTime)
                var str = "<tr><td class=\"text-center\">" + (i + 1) +
                    "</td><td class=\"text-center\">" + infoList[i].emailFrom +
                    "</td><td class=\"text-center\">" + infoList[i].emailTo +
                    "</td><td class=\"text-center hidden-xs\">" + infoList[i].subject +
                    "</td><td class=\"text-center hidden-xs\">" + sendTime +
                    "</td><td  class=\"text-center\"><div class=\"btn-group\">" +
                    "<button class=\"btn btn-xs btn-default\" type=\"button\" data-toggle=\"modal\" data-target=\"#modal-reply\" title=\"Edit Client\" onClick='getForm(" + infoList[i].emailId + ")'>"
                    + "恢复邮件</button>" +
                    "<button class=\"btn btn-xs btn-default\" type=\"button\" data-toggle=\"modal\" data-target=\"#modal-slideup\" title=\"Edit Client\" onClick='getForm(" + infoList[i].emailId + ")'>"
                    + "彻底删除</button>"
                    + "</div></td></tr>"
                $("#RecycleEmail").append(str)
            }
        };
        function timeFormatter(value) {
            console.log(value)
            var datetime = value.replace("T", " ").replace("Z", "")
            datetime=datetime.slice(0,datetime.indexOf("."));
            var time1 = datetime.split(' ')[0];
            // console.log("1、第二种方式time1:" + time1)
            var arrTime = datetime.split(' ')[1].split(':');
            // console.log("2、第二种方式arrTime:" + arrTime)
            var time2 = arrTime.slice(1, arrTime.length).join(':');
            // console.log("3、第二种方式time2:" + time2)
            var h = parseInt(arrTime[0]) + 8;
            // console.log('4、第二种方式小时：', h);
            var newH = ((h < 24) ? h : (h % 24)).toString();
            return time1 + ' ' + newH + ':' + time2;
            // return date
        }
        function getForm(id) {
            emailId = id;
        }
        $("#close").click(function () {
            window.location.href = "/DeledEmail";
        })
        $("#delEmail").click(function () {
            $.ajax({
                type: 'POST',
                url: '/CompleDelMail/',
                // async: false,
                data: {
                    mailId: emailId,
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                success: function (data) {
                    if (data.status == 200) {
                        alert("彻底删除成功");
                        window.location.href = "/DeledEmail";
                    }
                }
            })
        })
        $("#replyEmail").click(function() {
            $.ajax({
                type: 'POST',
                url: '/RecoverDeletedMail/',
                // async: false,
                data: {
                    mailId: emailId,
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                success: function (data) {
                    if (data.status == 200) {
                        alert("恢复成功");
                        window.location.href = "/DeledEmail";
                    }
                }
            })
        })

        $("#logout").click(function () {
            $.ajax({
                type: 'GET',
                url: '/Logout/',
                // async: false,
                data: {
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                success: function (data) {
                    if (data.status == 200) window.location.href = "/";
                }
            })
        })
    </script>

</body>

</html>